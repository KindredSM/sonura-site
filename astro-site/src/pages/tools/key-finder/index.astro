---
import BaseLayout from '../../../layouts/BaseLayout.astro';

const jsonLd = [
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Song Key & Scale Finder",
    "url": "https://sonurastudio.com/tools/key-finder/",
    "applicationCategory": "MusicApplication",
    "operatingSystem": "Web Browser",
    "description": "Free music key and scale reference tool. Find keys, scales, and compatible chords for any song. Essential for music producers and songwriters.",
    "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" }
  },
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://sonurastudio.com/" },
      { "@type": "ListItem", "position": 2, "name": "Tools", "item": "https://sonurastudio.com/tools/key-finder/" },
      { "@type": "ListItem", "position": 3, "name": "Key & Scale Finder", "item": "https://sonurastudio.com/tools/key-finder/" }
    ]
  },
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "How do I find the key of a song?",
        "acceptedAnswer": { "@type": "Answer", "text": "Select a root note and scale type (major or minor) to see all the notes and chords in that key. Use your ear to match the notes to the song, or use a chromatic tuner to identify the root note." }
      },
      {
        "@type": "Question",
        "name": "What is the difference between major and minor keys?",
        "acceptedAnswer": { "@type": "Answer", "text": "Major keys generally sound happy, bright, and uplifting. Minor keys sound sad, dark, or emotional. Most pop and country songs use major keys. Most trap, R&B, and cinematic music uses minor keys." }
      }
    ]
  }
];

const notes = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
const majorIntervals = [0, 2, 4, 5, 7, 9, 11];
const minorIntervals = [0, 2, 3, 5, 7, 8, 10];
const majorChordTypes = ['', 'm', 'm', '', '', 'm', 'dim'];
const minorChordTypes = ['m', 'dim', '', 'm', 'm', '', ''];
const numerals = ['I', 'II', 'III', 'IV', 'V', 'VI', 'VII'];
---

<BaseLayout
  title="Music Key & Scale Finder | Chords in Every Key - Sonura"
  description="Free music key and scale finder. See all notes and chords in any key. Major and minor scales with chord progressions. Essential tool for producers and songwriters."
  keywords="key finder, music key finder, scale finder, chords in key, music scale, find key of song, music theory tool, chord progression, what key is this song, key and scale finder"
  canonical="https://sonurastudio.com/tools/key-finder/"
  ogTitle="Music Key & Scale Finder - Sonura"
  ogDescription="Free tool to find notes and chords in any key. Major and minor scales."
  jsonLd={jsonLd}
>
  <style>
    .key-tool {
      max-width: 800px;
      margin: 80px auto;
      padding: 0 24px;
    }

    .key-selectors {
      display: flex;
      gap: 16px;
      justify-content: center;
      margin: 40px 0;
      flex-wrap: wrap;
    }

    .note-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
    }

    .note-btn {
      width: 52px;
      height: 52px;
      border-radius: 12px;
      border: 2px solid rgba(255,255,255,0.15);
      background: rgba(255,255,255,0.02);
      color: var(--fg);
      font-weight: 700;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.15s;
    }

    .note-btn:hover { border-color: var(--primary); }
    .note-btn.active { background: var(--primary); border-color: var(--primary); color: white; }

    .scale-btns {
      display: flex;
      gap: 8px;
    }

    .scale-btn {
      padding: 12px 28px;
      border-radius: 12px;
      border: 2px solid rgba(255,255,255,0.15);
      background: rgba(255,255,255,0.02);
      color: var(--fg);
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.15s;
    }

    .scale-btn:hover { border-color: var(--primary); }
    .scale-btn.active { background: var(--primary); border-color: var(--primary); color: white; }

    .result-section {
      margin-top: 48px;
      display: none;
    }

    .result-section.visible { display: block; }

    .key-name {
      font-size: 48px;
      font-weight: 800;
      text-align: center;
      margin-bottom: 8px;
    }

    .scale-notes {
      text-align: center;
      font-size: 20px;
      color: var(--muted);
      margin-bottom: 48px;
      letter-spacing: 2px;
    }

    .chords-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 16px;
      margin-bottom: 48px;
    }

    .chord-card {
      padding: 20px;
      background: rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      text-align: center;
    }

    .chord-numeral {
      font-size: 13px;
      color: var(--primary);
      margin-bottom: 8px;
      font-weight: 600;
    }

    .chord-name {
      font-size: 22px;
      font-weight: 700;
    }

    .chord-type {
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
    }

    .progressions-section {
      margin-top: 48px;
      padding: 32px;
      background: rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 16px;
    }

    .progressions-section h3 {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 20px;
    }

    .progression-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }

    .progression-item:last-child { border-bottom: none; }

    .prog-name { font-weight: 600; font-size: 14px; }
    .prog-chords { color: var(--primary); font-weight: 600; font-size: 15px; }
    .prog-desc { color: var(--muted); font-size: 13px; }

    .sonura-cta {
      margin-top: 64px;
      padding: 48px;
      background: rgba(124, 58, 237, 0.05);
      border: 1px solid rgba(124, 58, 237, 0.2);
      border-radius: 16px;
      text-align: center;
    }
  </style>

  <div class="key-tool">
    <h1 style="font-size: 40px; font-weight: 800; text-align: center; margin-bottom: 8px;">Key & Scale Finder</h1>
    <p style="color: var(--muted); font-size: 18px; text-align: center;">Select a root note and scale to see all notes and chords</p>

    <div class="key-selectors">
      <div class="note-grid" id="noteGrid">
        {notes.map((note) => (
          <button class={`note-btn ${note === 'C' ? 'active' : ''}`} data-note={note}>{note}</button>
        ))}
      </div>
    </div>

    <div style="display: flex; justify-content: center; margin-bottom: 16px;">
      <div class="scale-btns" id="scaleBtns">
        <button class="scale-btn active" data-scale="major">Major</button>
        <button class="scale-btn" data-scale="minor">Minor</button>
      </div>
    </div>

    <div class="result-section visible" id="resultSection">
      <div class="key-name" id="keyName">C Major</div>
      <div class="scale-notes" id="scaleNotes">C - D - E - F - G - A - B</div>

      <h2 style="font-size: 24px; font-weight: 700; margin-bottom: 20px; text-align: center;">Chords in Key</h2>
      <div class="chords-grid" id="chordsGrid"></div>

      <div class="progressions-section" id="progressionsSection">
        <h3>Common Progressions</h3>
        <div id="progressionsList"></div>
      </div>
    </div>

    <div class="sonura-cta">
      <h2 style="font-size: 28px; font-weight: 700; margin-bottom: 12px;">Found Your Key? Create Music</h2>
      <p style="color: var(--muted); margin-bottom: 24px;">Generate AI beats and instrumentals in any key in under 10 seconds. Free to start.</p>
      <a href="https://app.sonurastudio.com" style="display: inline-block; padding: 14px 32px; background: var(--primary); color: white; text-decoration: none; border-radius: 12px; font-weight: 600; font-size: 16px;">Create Music Free</a>
    </div>

    <section style="margin-top: 64px;">
      <h2 style="font-size: 24px; font-weight: 700; margin-bottom: 24px; text-align: center;">Key Finder FAQ</h2>
      <details style="padding: 20px; background: rgba(255,255,255,0.02); border-radius: 12px; cursor: pointer; margin-bottom: 12px;">
        <summary style="font-weight: 700;">How do I find the key of a song?</summary>
        <p style="color: var(--muted); line-height: 1.6; margin-top: 12px;">Listen for the note that feels like "home" - the note the melody or bass tends to resolve to. Try humming the lowest note during the chorus. Then match it using this tool. If the song feels happy, try major. If it feels sad or dark, try minor.</p>
      </details>
      <details style="padding: 20px; background: rgba(255,255,255,0.02); border-radius: 12px; cursor: pointer; margin-bottom: 12px;">
        <summary style="font-weight: 700;">What is the difference between major and minor?</summary>
        <p style="color: var(--muted); line-height: 1.6; margin-top: 12px;">Major keys sound bright, happy, and uplifting (think pop, country, upbeat music). Minor keys sound dark, emotional, or moody (think trap, R&B, cinematic music). Same root note, different emotional feel.</p>
      </details>
      <details style="padding: 20px; background: rgba(255,255,255,0.02); border-radius: 12px; cursor: pointer; margin-bottom: 12px;">
        <summary style="font-weight: 700;">What are the most common keys in music production?</summary>
        <p style="color: var(--muted); line-height: 1.6; margin-top: 12px;">C major and A minor are the most common (all white keys). For hip-hop and trap: C minor, D minor, G minor. For pop: C major, G major, D major. For R&B: Eb major, Bb major, Ab major.</p>
      </details>
      <details style="padding: 20px; background: rgba(255,255,255,0.02); border-radius: 12px; cursor: pointer; margin-bottom: 12px;">
        <summary style="font-weight: 700;">Why does the key matter for music production?</summary>
        <p style="color: var(--muted); line-height: 1.6; margin-top: 12px;">The key determines which notes and chords sound good together. It helps you stay in tune when layering instruments, writing melodies, and mixing vocals. It also affects the mood and energy of the track.</p>
      </details>
    </section>
  </div>

  <script define:vars={{ notes, majorIntervals, minorIntervals, majorChordTypes, minorChordTypes, numerals }}>
    let currentNote = 'C';
    let currentScale = 'major';

    const majorProgressions = [
      { name: 'Pop Classic', numerals: 'I - V - vi - IV', desc: 'The most popular progression in pop music' },
      { name: 'Axis', numerals: 'vi - IV - I - V', desc: 'Emotional pop and rock ballads' },
      { name: '50s', numerals: 'I - vi - IV - V', desc: 'Classic doo-wop and retro pop' },
      { name: 'Country/Folk', numerals: 'I - IV - V - I', desc: 'Simple and effective country and folk' },
    ];

    const minorProgressions = [
      { name: 'Trap/Dark', numerals: 'i - VI - III - VII', desc: 'Common in trap, drill, and dark hip-hop' },
      { name: 'Emotional', numerals: 'i - iv - VII - III', desc: 'Emotional R&B and ballads' },
      { name: 'Andalusian', numerals: 'i - VII - VI - V', desc: 'Flamenco, dramatic, cinematic' },
      { name: 'Minor Pop', numerals: 'i - III - VII - VI', desc: 'Modern pop with a dark edge' },
    ];

    function getScaleNotes(root, scale) {
      const rootIdx = notes.indexOf(root);
      const intervals = scale === 'major' ? majorIntervals : minorIntervals;
      return intervals.map(i => notes[(rootIdx + i) % 12]);
    }

    function getChords(root, scale) {
      const scaleNotes = getScaleNotes(root, scale);
      const chordTypes = scale === 'major' ? majorChordTypes : minorChordTypes;
      return scaleNotes.map((note, i) => ({
        name: note + chordTypes[i],
        numeral: numerals[i],
        type: chordTypes[i] === '' ? 'Major' : chordTypes[i] === 'm' ? 'Minor' : 'Diminished'
      }));
    }

    function getProgressionChords(progNumerals, chords) {
      return progNumerals.split(' - ').map(n => {
        const clean = n.replace(/[^IViv]/g, '');
        const idx = { 'I': 0, 'i': 0, 'II': 1, 'ii': 1, 'III': 2, 'iii': 2, 'IV': 3, 'iv': 3, 'V': 4, 'v': 4, 'VI': 5, 'vi': 5, 'VII': 6, 'vii': 6 }[clean];
        return idx !== undefined ? chords[idx].name : n;
      }).join(' - ');
    }

    function updateDisplay() {
      const scaleNotes = getScaleNotes(currentNote, currentScale);
      const chords = getChords(currentNote, currentScale);
      const scaleName = currentScale.charAt(0).toUpperCase() + currentScale.slice(1);

      document.getElementById('keyName').textContent = `${currentNote} ${scaleName}`;
      document.getElementById('scaleNotes').textContent = scaleNotes.join(' - ');

      const grid = document.getElementById('chordsGrid');
      grid.innerHTML = chords.map(c => `
        <div class="chord-card">
          <div class="chord-numeral">${c.numeral}</div>
          <div class="chord-name">${c.name}</div>
          <div class="chord-type">${c.type}</div>
        </div>
      `).join('');

      const progs = currentScale === 'major' ? majorProgressions : minorProgressions;
      const list = document.getElementById('progressionsList');
      list.innerHTML = progs.map(p => `
        <div class="progression-item">
          <div><div class="prog-name">${p.name}</div><div class="prog-desc">${p.desc}</div></div>
          <div class="prog-chords">${getProgressionChords(p.numerals, chords)}</div>
        </div>
      `).join('');
    }

    document.querySelectorAll('.note-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.note-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentNote = btn.dataset.note;
        updateDisplay();
      });
    });

    document.querySelectorAll('.scale-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.scale-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentScale = btn.dataset.scale;
        updateDisplay();
      });
    });

    updateDisplay();
  </script>
</BaseLayout>
