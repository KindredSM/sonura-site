---
import BaseLayout from './BaseLayout.astro';

interface Props {
  title: string;
  description: string;
  keywords?: string;
  slug: string;
  publishedDate: string;
  readTime?: string;
  ogTitle?: string;
  toc?: { id: string; label: string }[];
}

const {
  title,
  description,
  keywords = '',
  slug,
  publishedDate,
  readTime = '5 min read',
  ogTitle,
  toc = [],
} = Astro.props;

const canonical = `https://sonurastudio.com/blog/${slug}/`;

const jsonLd = [
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": title,
    "description": description,
    "author": { "@type": "Organization", "name": "Sonura" },
    "publisher": {
      "@type": "Organization",
      "name": "Sonura",
      "logo": { "@type": "ImageObject", "url": "https://sonurastudio.com/demo-image.jpeg" }
    },
    "datePublished": publishedDate,
    "dateModified": publishedDate,
    "image": "https://sonurastudio.com/demo-image.jpeg"
  },
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://sonurastudio.com/" },
      { "@type": "ListItem", "position": 2, "name": "Blog", "item": "https://sonurastudio.com/blog/" },
      { "@type": "ListItem", "position": 3, "name": title, "item": canonical }
    ]
  }
];

const formattedDate = new Date(publishedDate).toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});
---

<BaseLayout
  title={title}
  description={description}
  keywords={keywords}
  canonical={canonical}
  ogType="article"
  ogTitle={ogTitle || title}
  publishedTime={publishedDate}
  jsonLd={jsonLd}
>
  <Fragment slot="head">
    <style>
      @media (min-width: 1024px) {
        .blog-toc { display: block !important; }
      }
      .blog-toc::-webkit-scrollbar { width: 6px; }
      .blog-toc::-webkit-scrollbar-track { background: transparent; }
      .blog-toc::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 3px; }
      .blog-toc::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.2); }
    </style>
  </Fragment>

  <div style="display: flex; max-width: 1280px; margin: 80px auto; padding: 0 24px; gap: 48px;">
    <article style="flex: 1; min-width: 0; color: var(--fg); line-height: 1.8;">
      <header style="margin-bottom: 48px;">
        <h1 style="font-size: 42px; font-weight: 800; margin-bottom: 16px; line-height: 1.2;">{title}</h1>
        <div style="color: var(--muted); font-size: 14px; margin-bottom: 24px;">
          <time datetime={publishedDate}>{formattedDate}</time> • {readTime}
        </div>
        <p style="font-size: 20px; color: var(--muted); line-height: 1.6;">{description}</p>
      </header>

      <slot />

      <footer style="margin-top: 64px; padding-top: 32px; border-top: 1px solid rgba(255,255,255,0.1);">
        <p style="color: var(--muted); font-size: 14px;">
          <a href="/" style="color: var(--primary); text-decoration: none;">← Back to home</a> | 
          <a href="/genre/trap/" style="color: var(--primary); text-decoration: none;">Try trap beats</a> |
          <a href="/genre/lofi/" style="color: var(--primary); text-decoration: none;">Try lo-fi beats</a>
        </p>
      </footer>
    </article>

    {toc.length > 0 && (
      <nav style="position: sticky; top: 120px; width: 240px; height: fit-content; max-height: calc(100vh - 140px); overflow-y: auto; flex-shrink: 0; display: none;" class="blog-toc">
        <div style="font-size: 14px; font-weight: 600; margin-bottom: 16px; color: var(--fg); text-transform: uppercase; letter-spacing: 0.5px;">On This Page</div>
        <ul style="list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 8px;">
          {toc.map((item) => (
            <li>
              <a href={`#${item.id}`} style="color: var(--muted); text-decoration: none; font-size: 14px; line-height: 1.4; display: block; transition: color 0.2s;">{item.label}</a>
            </li>
          ))}
        </ul>
      </nav>
    )}
  </div>
</BaseLayout>

