---
import BaseLayout from './BaseLayout.astro';

interface WorkflowItem {
  image: string;
  imageAlt: string;
  title: string;
  description: string;
}

interface FAQ {
  question: string;
  answer: string;
}

interface DemoTrack {
  title: string;
  tags: string[];
  useCase: string;
  audioSrc: string;
}

interface Props {
  genre: string;
  genreSlug: string;
  title: string;
  description: string;
  keywords: string;
  headline: string;
  subhead: string;
  ctaText: string;
  workflowTitle: string;
  workflowItems: WorkflowItem[];
  faqs: FAQ[];
  demoTitle?: string;
  demoTracks?: DemoTrack[];
  trustItems?: string[];
  finalCtaTitle?: string;
  finalCtaButtonText?: string;
}

const {
  genre,
  genreSlug,
  title,
  description,
  keywords,
  headline,
  subhead,
  ctaText,
  workflowTitle,
  workflowItems,
  faqs,
  demoTitle,
  demoTracks = [],
  trustItems = [],
  finalCtaTitle,
  finalCtaButtonText,
} = Astro.props;

const canonical = `https://sonurastudio.com/genre/${genreSlug}/`;

const jsonLd = [
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": `Sonura ${genre} Beat Maker`,
    "url": canonical,
    "applicationCategory": "MultimediaApplication",
    "genre": genre,
    "description": description
  },
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://sonurastudio.com/" },
      { "@type": "ListItem", "position": 2, "name": `${genre} Beat Maker`, "item": canonical }
    ]
  },
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": faqs.map(faq => ({
      "@type": "Question",
      "name": faq.question,
      "acceptedAnswer": {
        "@type": "Answer",
        "text": faq.answer
      }
    }))
  }
];
---

<BaseLayout
  title={title}
  description={description}
  keywords={keywords}
  canonical={canonical}
  ogTitle={title}
  ogDescription={description}
  jsonLd={jsonLd}
  bodyClass="genre-page"
>
  <section class="hero">
    <div class="hero-background">
      <div class="hero-gradient"></div>
      <div class="hero-noise"></div>
    </div>
    <div class="hero-content">
      <h1 class="headline reveal">{headline}</h1>
      <p class="subhead reveal" data-reveal-delay="0.06s" style="max-width: 70vw; margin-left: auto; margin-right: auto;">{subhead}</p>
      <div class="cta">
        <a class="button primary" href="https://app.sonurastudio.com" target="_blank" rel="noopener">{ctaText}</a>
        <a class="hero-beta-link" href="/">Explore all genres â†’</a>
      </div>
    </div>
  </section>
  
  <section class="workflow" aria-labelledby="workflow-title">
    <div class="workflow-inner">
      <h2 id="workflow-title" class="workflow-title reveal">{workflowTitle}</h2>
      <div class="workflow-grid">
        {workflowItems.map((item, index) => (
          <div class={`workflow-item ${index % 2 === 1 ? 'workflow-item-reverse' : ''} reveal`} data-reveal-delay={`${0.04 * (index + 1)}s`}>
            <div class="workflow-image">
              <img src={item.image} alt={item.imageAlt} loading="lazy">
            </div>
            <div class="workflow-content">
              <h3 class="workflow-item-title">{item.title}</h3>
              <p class="workflow-item-description">{item.description}</p>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  {demoTracks.length > 0 && (
    <section class="demo" aria-labelledby="demo-title">
      <div class="demo-inner">
        <div class="demo-header">
          <div class="demo-header-content">
            <h2 id="demo-title" class="demo-title">{demoTitle || `Hear ${genre} Beats Made with Sonura`}</h2>
          </div>
        </div>
        <div class="demo-tracks">
          {demoTracks.map((track, index) => (
            <div class="player reveal" data-reveal-delay={`${0.06 * index}s`} role="region" aria-label="Audio player" data-track={index}>
              <div class="player-header">
                <div class="player-art" aria-hidden="true">
                  <div class="art-waveform"></div>
                  <img src="/record.jpeg" alt={`${track.title} artwork`}/>
                </div>
                <div class="player-info">
                  <div class="player-track">{track.title}</div>
                  <div class="player-tags">
                    {track.tags.map((tag) => (
                      <span class="tag tag-genre">{tag}</span>
                    ))}
                  </div>
                  <div class="player-use-case">{track.useCase}</div>
                </div>
              </div>
              <div class="player-main">
                <div class="player-controls">
                  <button class="player-back button icon" aria-label="Back 10 seconds"><i data-lucide="skip-back"></i></button>
                  <button class="player-play button primary circle" aria-label="Play"><i data-lucide="play"></i></button>
                  <button class="player-forward button icon" aria-label="Forward 10 seconds"><i data-lucide="skip-forward"></i></button>
                </div>
                <div class="player-progress">
                  <span class="player-current time">0:00</span>
                  <input class="player-seek" type="range" min="0" max="100" value="0" aria-label="Seek"/>
                  <span class="player-duration time">0:00</span>
                </div>
                <div class="player-side">
                  <div class="volume">
                    <i data-lucide="volume-2" aria-hidden="true"></i>
                    <input class="player-volume" type="range" min="0" max="1" step="0.01" value="0.9" aria-label="Volume"/>
                  </div>
                </div>
              </div>
              <audio class="player-audio" preload="metadata">
                <source src={track.audioSrc} type="audio/mpeg"/>
              </audio>
            </div>
          ))}
        </div>
      </div>
    </section>
  )}

  <section class="faq" id="faq" aria-labelledby="faq-title">
    <div class="faq-inner">
      <h2 id="faq-title" class="faq-title">{genre} Beat Maker FAQ</h2>
      <div class="faq-list">
        {faqs.map((faq, index) => (
          <details class="reveal" data-reveal-delay={`${0.03 * index}s`}>
            <summary>{faq.question}</summary>
            <p>{faq.answer}</p>
          </details>
        ))}
      </div>
    </div>
  </section>

  <section class="final-cta" aria-labelledby="final-cta-title">
    <div class="final-cta-inner">
      <h2 id="final-cta-title" class="final-cta-title reveal">{finalCtaTitle || `Start Making ${genre} Music Now`}</h2>
      <p class="final-cta-subtitle reveal" data-reveal-delay="0.06s">free to start. no credit card required.</p>
      <div class="final-cta-form reveal" data-reveal-delay="0.12s">
        <a class="button primary large" href="https://app.sonurastudio.com" target="_blank" rel="noopener">{finalCtaButtonText || `create ${genre.toLowerCase()} music free`}</a>
      </div>
      {trustItems.length > 0 && (
        <div class="final-cta-trust reveal" data-reveal-delay="0.18s">
          {trustItems.map((item) => (
            <div class="trust-item"><i data-lucide="check"></i> <span>{item}</span></div>
          ))}
        </div>
      )}
    </div>
  </section>
</BaseLayout>
